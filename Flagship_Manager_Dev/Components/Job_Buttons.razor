@using FlagShip_Manager.Helpers;
@using FlagShip_Manager.Objects;
@using FlagShip_Manager.Management_Server;
@*
    Buttons for controlling Job status
*@

<style>
    .JobButtons {
        background: #595959;
        -webkit-text-fill-color: #E4E4E4;
        height: 25px;
        width: 70px;
        border: none;
        border-radius: 15px;
        font-size: 10px;
        align-items: center;
        margin-left: 1px;
        margin-right: 1px;
        position: relative;
        bottom: 1.5px;
    }

    .JobButtons:active {
        transition-duration: 0.1s;
        transition-property: all;
        background: #737370;
        height: 23px;
        margin-left: 2px;
        margin-right: 2px;
        width: 68px;
    }

    .JobButtons:hover {
        background: #737373;
    }

</style>

@if(!activeJob.Archive)
{
    <div class="TableCell" style="width: 10px;"></div>
    
    <div class="TableCell"><button class="JobButtons" style="visibility: @ShowHideCancelButton(_Status)" @onclick="() => { 
        activeJob.Cancel();
        CheckID.InvokeAsync(activeJob);
    }">Cancel</button></div>
    
    @if (_Status == 3 || _Status == 5)
    {
        <div class="TableCell"><button class="JobButtons" style="visibility: @ShowHideResumeButton(_Status)" @onclick="() => {
            activeJob.PauseOrResume();
            CheckID.InvokeAsync(activeJob);
        }">Resume</button></div>
    }
    else
    {
        <div class="TableCell"><button class="JobButtons" style="visibility: @ShowHideCancelButton(_Status)" @onclick="() => {
            activeJob.PauseOrResume();
            CheckID.InvokeAsync(activeJob);
        }">Pause</button></div>
    }
    <div class="TableCell"><button class="JobButtons" @onclick="() => {
        activeJob.Restart();
        CheckID.InvokeAsync(activeJob);
    }">Restart</button></div>
    
    <div class="TableCell"><button class="JobButtons" @onclick="() => {
        DB.AddToArchive(activeJob);
        CheckID.InvokeAsync(activeJob);
    }">Archive</button></div>
}
else
{
    <div class="TableCell" style="width: 80px;"></div>
    <div class="TableCell"><button class="JobButtons" @onclick="() => {
        ReturnJobToQueue(activeJob);
        CheckID.InvokeAsync(activeJob);
        }">Re-Queue</button></div>
    
    <div class="TableCell"><button class="JobButtons" @onclick="() => {
        activeJob.Restart(); 
        DB.AddToActive(activeJob, true);
        CheckID.InvokeAsync(activeJob);
    }">Restart</button></div>
    
    <div class="TableCell"><button class="JobButtons" @onclick="() => {
        DB.RemoveJob(activeJob);
        CheckID.InvokeAsync(activeJob);
    }">Delete</button></div>
}
@code {
    [Parameter]
    public int _Status { get; set; } = 0;
    [Parameter]
    public Job activeJob { get; set; }
    [Parameter]
    public EventCallback UpdateList { get; set; }
    [Parameter]
    public EventCallback<Job> CheckID { get; set; }

    public string ShowBatch { get; set; } = "block";

    public string ShowHideCancelButton(int _status)
    {
        //Toggles weither the Cancel button is visable depending on Job status.

        if (_status == 5 || _status == 2 || _status == 4) return "hidden";
        else return "visible";
    }
    public string ShowHideResumeButton(int _status)
    {
        //Thoggles weither the Pause or resume button is visable.

        if (_status == 5 || _status == 3) return "visible";
        else return "hidden";
    }
    public static void ReturnJobToQueue(Job j)
    {
        //Moves job from Archive to Active queue.

        if (!j.finished)
        {
            j.Status = 0;
            foreach (var rt in j.renderTasks)
            {
                if (rt.Status != 2) rt.Status = 0;
            }
        }
        DB.AddToActive(j, true);
    }
    
}
